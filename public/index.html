<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SVG to PNG - åœ¨çº¿è½¬æ¢å·¥å…·</title>
  <meta name="description" content="åœ¨çº¿ SVG è½¬ PNG å·¥å…·ï¼Œå®Œç¾æ”¯æŒ foreignObjectï¼Œæ”¯æŒæ‰¹é‡è½¬æ¢">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --bg-dark: #0f0f1a;
      --bg-card: #1c1c2e;
      --bg-input: #232340;
      --text-primary: #ffffff;
      --text-secondary: #a0a0b8;
      --border: rgba(255,255,255,0.1);
      --success: #22c55e;
      --error: #ef4444;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
    }
    
    .container {
      max-width: 800px;
      width: 100%;
    }
    
    header {
      text-align: center;
      margin-bottom: 50px;
    }
    
    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #6366f1, #a855f7, #ec4899);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 12px;
    }
    
    .subtitle {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }
    
    .feature-badges {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .badge {
      padding: 6px 14px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 0.85rem;
      color: var(--text-secondary);
    }
    
    .badge.highlight {
      background: linear-gradient(135deg, rgba(99,102,241,0.2), rgba(168,85,247,0.2));
      border-color: rgba(99,102,241,0.4);
      color: #a78bfa;
    }
    
    .upload-card {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 40px;
      margin-bottom: 30px;
      border: 1px solid var(--border);
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
    }
    
    .tab {
      flex: 1;
      padding: 14px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text-secondary);
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .tab:hover {
      border-color: var(--primary);
      color: var(--text-primary);
    }
    
    .tab.active {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-color: var(--primary);
      color: white;
    }
    
    .dropzone {
      border: 2px dashed var(--border);
      border-radius: 16px;
      padding: 60px 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: var(--bg-input);
    }
    
    .dropzone:hover, .dropzone.dragover {
      border-color: var(--primary);
      background: rgba(99,102,241,0.1);
    }
    
    .dropzone-icon {
      font-size: 4rem;
      margin-bottom: 20px;
    }
    
    .dropzone-text {
      font-size: 1.2rem;
      color: var(--text-primary);
      margin-bottom: 8px;
    }
    
    .dropzone-hint {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    
    .options {
      display: flex;
      gap: 20px;
      margin-top: 25px;
      align-items: center;
      justify-content: center;
    }
    
    .option-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .option-group label {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
    
    .option-group select {
      padding: 10px 16px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 0.95rem;
      cursor: pointer;
    }
    
    .option-group select:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    .file-input {
      display: none;
    }
    
    .file-list {
      margin-top: 25px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--bg-input);
      border-radius: 10px;
      margin-bottom: 8px;
    }
    
    .file-item-name {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .file-item-icon {
      font-size: 1.2rem;
    }
    
    .file-item-remove {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 1.2rem;
      transition: color 0.2s;
    }
    
    .file-item-remove:hover {
      color: var(--error);
    }
    
    .convert-btn {
      width: 100%;
      padding: 18px;
      margin-top: 25px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border: none;
      border-radius: 12px;
      color: white;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .convert-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(99,102,241,0.4);
    }
    
    .convert-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .convert-btn.loading {
      pointer-events: none;
    }
    
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .result {
      margin-top: 20px;
      padding: 16px 20px;
      border-radius: 12px;
      display: none;
    }
    
    .result.success {
      display: block;
      background: rgba(34,197,94,0.15);
      border: 1px solid rgba(34,197,94,0.3);
      color: var(--success);
    }
    
    .result.error {
      display: block;
      background: rgba(239,68,68,0.15);
      border: 1px solid rgba(239,68,68,0.3);
      color: var(--error);
    }
    
    footer {
      margin-top: 50px;
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    
    footer a {
      color: var(--primary);
      text-decoration: none;
    }
    
    @media (max-width: 600px) {
      h1 { font-size: 1.8rem; }
      .upload-card { padding: 25px; }
      .dropzone { padding: 40px 20px; }
      .tabs { flex-direction: column; }
      .options { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ¨ SVG to PNG</h1>
      <p class="subtitle">åœ¨çº¿ SVG è½¬ PNG å·¥å…·ï¼Œå®Œç¾æ”¯æŒ foreignObject</p>
      <div class="feature-badges">
        <span class="badge highlight">âœ¨ æ”¯æŒ foreignObject</span>
        <span class="badge">ğŸ“¦ æ‰¹é‡è½¬æ¢</span>
        <span class="badge">ğŸ”¥ 2K é«˜æ¸…è¾“å‡º</span>
        <span class="badge">ğŸ’¯ å…è´¹ä½¿ç”¨</span>
      </div>
    </header>
    
    <div class="upload-card">
      <div class="tabs">
        <button class="tab active" data-mode="single">å•ä¸ªæ–‡ä»¶</button>
        <button class="tab" data-mode="batch">æ‰¹é‡è½¬æ¢</button>
      </div>
      
      <div class="dropzone" id="dropzone">
        <div class="dropzone-icon">ğŸ“</div>
        <div class="dropzone-text">æ‹–æ‹½ SVG æ–‡ä»¶åˆ°è¿™é‡Œ</div>
        <div class="dropzone-hint">æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
        <input type="file" class="file-input" id="fileInput" accept=".svg,image/svg+xml">
      </div>
      
      <div class="options">
        <div class="option-group">
          <label for="scale">è¾“å‡ºå€ç‡ï¼š</label>
          <select id="scale">
            <option value="1">1xï¼ˆåŸå§‹å°ºå¯¸ï¼‰</option>
            <option value="2" selected>2xï¼ˆé«˜æ¸…ï¼‰</option>
            <option value="3">3xï¼ˆè¶…é«˜æ¸…ï¼‰</option>
          </select>
        </div>
      </div>
      
      <div class="file-list" id="fileList"></div>
      
      <button class="convert-btn" id="convertBtn" disabled>
        <span>å¼€å§‹è½¬æ¢</span>
      </button>
      
      <div class="result" id="result"></div>
    </div>
    
    <footer>
      <p>åŸºäº Puppeteer æ„å»º | <a href="https://github.com" target="_blank">GitHub</a></p>
      <p style="margin-top: 8px;">zhangAI Â· 2025</p>
    </footer>
  </div>

  <script>
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const convertBtn = document.getElementById('convertBtn');
    const result = document.getElementById('result');
    const tabs = document.querySelectorAll('.tab');
    const scaleSelect = document.getElementById('scale');
    
    let selectedFiles = [];
    let mode = 'single';
    
    // åˆ‡æ¢æ¨¡å¼
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        mode = tab.dataset.mode;
        fileInput.multiple = mode === 'batch';
        selectedFiles = [];
        updateFileList();
        updateButton();
      });
    });
    
    // æ‹–æ‹½äº‹ä»¶
    dropzone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropzone.classList.add('dragover');
    });
    
    dropzone.addEventListener('dragleave', () => {
      dropzone.classList.remove('dragover');
    });
    
    dropzone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropzone.classList.remove('dragover');
      handleFiles(e.dataTransfer.files);
    });
    
    dropzone.addEventListener('click', () => {
      fileInput.click();
    });
    
    fileInput.addEventListener('change', (e) => {
      handleFiles(e.target.files);
    });
    
    function handleFiles(files) {
      const svgFiles = Array.from(files).filter(f => 
        f.type === 'image/svg+xml' || f.name.endsWith('.svg')
      );
      
      if (mode === 'single') {
        selectedFiles = svgFiles.slice(0, 1);
      } else {
        selectedFiles = [...selectedFiles, ...svgFiles].slice(0, 50);
      }
      
      updateFileList();
      updateButton();
      hideResult();
    }
    
    function updateFileList() {
      if (selectedFiles.length === 0) {
        fileList.innerHTML = '';
        return;
      }
      
      fileList.innerHTML = selectedFiles.map((file, index) => `
        <div class="file-item">
          <div class="file-item-name">
            <span class="file-item-icon">ğŸ“„</span>
            <span>${file.name}</span>
          </div>
          <button class="file-item-remove" onclick="removeFile(${index})">âœ•</button>
        </div>
      `).join('');
    }
    
    function removeFile(index) {
      selectedFiles.splice(index, 1);
      updateFileList();
      updateButton();
    }
    
    function updateButton() {
      convertBtn.disabled = selectedFiles.length === 0;
      convertBtn.innerHTML = selectedFiles.length > 1 
        ? `<span>è½¬æ¢ ${selectedFiles.length} ä¸ªæ–‡ä»¶</span>`
        : '<span>å¼€å§‹è½¬æ¢</span>';
    }
    
    function hideResult() {
      result.classList.remove('success', 'error');
      result.style.display = 'none';
    }
    
    function showResult(message, type) {
      result.textContent = message;
      result.classList.remove('success', 'error');
      result.classList.add(type);
      result.style.display = 'block';
    }
    
    // è½¬æ¢
    convertBtn.addEventListener('click', async () => {
      if (selectedFiles.length === 0) return;
      
      convertBtn.classList.add('loading');
      convertBtn.innerHTML = '<div class="spinner"></div><span>è½¬æ¢ä¸­...</span>';
      hideResult();
      
      try {
        const formData = new FormData();
        const scale = scaleSelect.value;
        formData.append('scale', scale);
        
        if (selectedFiles.length === 1) {
          // å•ä¸ªæ–‡ä»¶
          formData.append('svg', selectedFiles[0]);
          
          const response = await fetch('/api/convert', {
            method: 'POST',
            body: formData
          });
          
          if (!response.ok) {
            const error = await response.json();
            throw new Error(error.error || 'è½¬æ¢å¤±è´¥');
          }
          
          const blob = await response.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = selectedFiles[0].name.replace('.svg', '.png');
          a.click();
          URL.revokeObjectURL(url);
          
          const width = response.headers.get('X-Image-Width');
          const height = response.headers.get('X-Image-Height');
          showResult(`âœ… è½¬æ¢æˆåŠŸï¼è¾“å‡ºå°ºå¯¸: ${width}Ã—${height}px`, 'success');
          
        } else {
          // æ‰¹é‡è½¬æ¢
          selectedFiles.forEach(file => {
            formData.append('svgs', file);
          });
          
          const response = await fetch('/api/convert-batch', {
            method: 'POST',
            body: formData
          });
          
          if (!response.ok) {
            const error = await response.json();
            throw new Error(error.error || 'è½¬æ¢å¤±è´¥');
          }
          
          const blob = await response.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `svg-to-png-${Date.now()}.zip`;
          a.click();
          URL.revokeObjectURL(url);
          
          showResult(`âœ… æ‰¹é‡è½¬æ¢æˆåŠŸï¼å·²ä¸‹è½½ ${selectedFiles.length} ä¸ªæ–‡ä»¶çš„ ZIP åŒ…`, 'success');
        }
        
      } catch (error) {
        showResult(`âŒ ${error.message}`, 'error');
      } finally {
        convertBtn.classList.remove('loading');
        updateButton();
      }
    });
  </script>
</body>
</html>
